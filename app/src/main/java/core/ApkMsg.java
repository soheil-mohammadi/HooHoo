package core;

import android.content.pm.PackageInfo;
import android.graphics.drawable.Drawable;
import android.net.Uri;

import java.io.File;
import java.util.UUID;

import core.models.FileModel;
import servers.monitor.fastest.hoohoonew.App;

public class ApkMsg {

    private static ApkMsg instance ;
    private final String pathVideoDir = "Apps";

    public static final String APK_LOGO_SVG = "M 1330.00,1330.00\\n\" +\n" +
            "          \"           C 1330.00,1330.00 1330.00,512.00 1330.00,1330.00\\n\" +\n" +
            "          \"             1330.00,1330.00 1330.00,1330.00 1330.00,1330.00\\n\" +\n" +
            "          \"             1330.00,1330.00 1330.00,1330.00 1330.00,1330.00\\n\" +\n" +
            "          \"             1330.00,1330.00 1330.00,1330.00 1330.00,1330.00 Z\\n\" +\n" +
            "          \"           M 312.00,90.00\\n\" +\n" +
            "          \"           C 319.03,92.00 325.27,95.97 331.00,100.42\\n\" +\n" +
            "          \"             353.11,117.58 367.98,148.98 368.00,177.00\\n\" +\n" +
            "          \"             368.00,177.00 144.00,177.00 144.00,177.00\\n\" +\n" +
            "          \"             144.02,152.34 155.62,124.38 173.00,107.00\\n\" +\n" +
            "          \"             179.93,100.08 189.47,92.72 199.00,90.00\\n\" +\n" +
            "          \"             195.11,83.34 189.54,78.14 184.98,72.00\\n\" +\n" +
            "          \"             183.79,70.40 181.15,66.82 183.62,65.08\\n\" +\n" +
            "          \"             186.34,63.16 189.86,67.27 191.41,69.02\\n\" +\n" +
            "          \"             195.43,73.58 202.34,85.48 209.00,84.51\\n\" +\n" +
            "          \"             209.00,84.51 231.00,79.43 231.00,79.43\\n\" +\n" +
            "          \"             242.98,77.65 251.09,77.98 263.00,78.00\\n\" +\n" +
            "          \"             270.76,78.01 282.45,79.52 290.00,81.37\\n\" +\n" +
            "          \"             292.67,82.03 303.15,85.18 304.99,84.89\\n\" +\n" +
            "          \"             309.21,84.21 318.02,71.65 321.42,68.06\\n\" +\n" +
            "          \"             322.89,66.51 326.87,62.71 328.92,65.62\\n\" +\n" +
            "          \"             330.50,67.86 327.67,71.31 326.37,73.00\\n\" +\n" +
            "          \"             326.37,73.00 312.00,90.00 312.00,90.00 Z\\n\" +\n" +
            "          \"           M 164.00,160.00\\n\" +\n" +
            "          \"           C 164.00,160.00 348.00,160.00 348.00,160.00\\n\" +\n" +
            "          \"             347.48,154.19 345.48,149.30 343.14,144.00\\n\" +\n" +
            "          \"             334.79,125.12 321.98,112.20 303.00,104.00\\n\" +\n" +
            "          \"             290.69,98.69 277.52,95.16 264.00,95.00\\n\" +\n" +
            "          \"             264.00,95.00 249.00,95.00 249.00,95.00\\n\" +\n" +
            "          \"             218.66,95.05 188.71,108.19 173.01,135.00\\n\" +\n" +
            "          \"             168.97,141.90 164.72,152.02 164.00,160.00 Z\\n\" +\n" +
            "          \"           M 98.00,176.33\\n\" +\n" +
            "          \"           C 116.00,174.33 127.97,181.80 128.00,201.00\\n\" +\n" +
            "          \"             128.00,201.00 128.00,295.00 128.00,295.00\\n\" +\n" +
            "          \"             127.99,301.40 127.79,305.68 123.61,311.00\\n\" +\n" +
            "          \"             113.13,324.33 90.70,323.23 82.41,308.00\\n\" +\n" +
            "          \"             79.96,303.48 80.01,299.94 80.00,295.00\\n\" +\n" +
            "          \"             80.00,295.00 80.00,199.00 80.00,199.00\\n\" +\n" +
            "          \"             80.14,187.43 86.64,179.06 98.00,176.33 Z\\n\" +\n" +
            "          \"           M 402.00,176.33\\n\" +\n" +
            "          \"           C 420.00,174.33 431.97,181.80 432.00,201.00\\n\" +\n" +
            "          \"             432.00,201.00 432.00,295.00 432.00,295.00\\n\" +\n" +
            "          \"             431.99,299.94 432.04,303.48 429.59,308.00\\n\" +\n" +
            "          \"             421.30,323.23 398.87,324.33 388.39,311.00\\n\" +\n" +
            "          \"             384.21,305.68 384.01,301.40 384.00,295.00\\n\" +\n" +
            "          \"             384.00,295.00 384.00,199.00 384.00,199.00\\n\" +\n" +
            "          \"             384.14,187.43 390.64,179.06 402.00,176.33 Z\\n\" +\n" +
            "          \"           M 369.00,192.00\\n\" +\n" +
            "          \"           C 369.00,192.00 369.00,352.00 369.00,352.00\\n\" +\n" +
            "          \"             368.99,357.70 368.58,367.49 363.66,371.26\\n\" +\n" +
            "          \"             361.16,373.18 357.98,372.98 355.00,373.00\\n\" +\n" +
            "          \"             355.00,373.00 330.00,373.00 330.00,373.00\\n\" +\n" +
            "          \"             330.00,373.00 330.00,419.00 330.00,419.00\\n\" +\n" +
            "          \"             329.97,426.19 329.12,432.91 324.90,438.96\\n\" +\n" +
            "          \"             316.90,450.42 297.91,451.20 288.09,441.82\\n\" +\n" +
            "          \"             282.15,436.14 281.01,430.81 281.00,423.00\\n\" +\n" +
            "          \"             281.00,423.00 281.00,373.00 281.00,373.00\\n\" +\n" +
            "          \"             281.00,373.00 232.00,373.00 232.00,373.00\\n\" +\n" +
            "          \"             232.00,373.00 232.00,416.00 232.00,416.00\\n\" +\n" +
            "          \"             232.00,423.65 233.01,431.37 228.35,438.00\\n\" +\n" +
            "          \"             218.74,451.70 197.26,451.70 187.65,438.00\\n\" +\n" +
            "          \"             184.10,432.95 184.01,428.86 184.00,423.00\\n\" +\n" +
            "          \"             184.00,423.00 184.00,373.00 184.00,373.00\\n\" +\n" +
            "          \"             184.00,373.00 160.00,373.00 160.00,373.00\\n\" +\n" +
            "          \"             157.05,373.00 153.70,373.21 151.02,371.83\\n\" +\n" +
            "          \"             145.45,368.96 144.08,363.73 144.00,358.00\\n\" +\n" +
            "          \"             144.00,358.00 144.00,331.00 144.00,331.00\\n\" +\n" +
            "          \"             144.00,331.00 144.00,192.00 144.00,192.00\\n\" +\n" +
            "          \"             144.00,192.00 369.00,192.00 369.00,192.00 Z\\n\" +\n" +
            "          \"           M 101.11,193.74\\n\" +\n" +
            "          \"           C 93.87,198.27 96.00,210.46 96.00,218.00\\n\" +\n" +
            "          \"             96.00,218.00 96.00,288.00 96.00,288.00\\n\" +\n" +
            "          \"             96.01,291.75 95.85,296.55 98.09,299.77\\n\" +\n" +
            "          \"             101.20,304.26 107.85,303.70 110.43,298.89\\n\" +\n" +
            "          \"             112.14,295.71 111.99,291.51 112.00,288.00\\n\" +\n" +
            "          \"             112.00,288.00 112.00,206.00 112.00,206.00\\n\" +\n" +
            "          \"             111.91,198.47 110.36,191.65 101.11,193.74 Z\\n\" +\n" +
            "          \"           M 405.11,193.74\\n\" +\n" +
            "          \"           C 397.87,198.27 400.00,210.46 400.00,218.00\\n\" +\n" +
            "          \"             400.00,218.00 400.00,288.00 400.00,288.00\\n\" +\n" +
            "          \"             400.01,291.51 399.86,295.71 401.57,298.89\\n\" +\n" +
            "          \"             404.15,303.70 410.80,304.26 413.91,299.77\\n\" +\n" +
            "          \"             416.15,296.55 415.99,291.75 416.00,288.00\\n\" +\n" +
            "          \"             416.00,288.00 416.00,206.00 416.00,206.00\\n\" +\n" +
            "          \"             415.91,198.47 414.36,191.65 405.11,193.74 Z\\n\" +\n" +
            "          \"           M 160.00,208.00\\n\" +\n" +
            "          \"           C 160.00,208.00 160.00,357.00 160.00,357.00\\n\" +\n" +
            "          \"             160.00,357.00 200.00,357.00 200.00,357.00\\n\" +\n" +
            "          \"             200.00,357.00 200.00,418.00 200.00,418.00\\n\" +\n" +
            "          \"             200.07,423.46 200.86,430.79 208.00,430.79\\n\" +\n" +
            "          \"             215.14,430.79 215.93,423.46 216.00,418.00\\n\" +\n" +
            "          \"             216.00,418.00 216.00,357.00 216.00,357.00\\n\" +\n" +
            "          \"             216.00,357.00 298.00,357.00 298.00,357.00\\n\" +\n" +
            "          \"             298.00,357.00 298.00,421.00 298.00,421.00\\n\" +\n" +
            "          \"             298.21,432.40 307.12,432.37 310.44,428.69\\n\" +\n" +
            "          \"             313.17,425.66 312.99,419.84 313.00,416.00\\n\" +\n" +
            "          \"             313.00,416.00 313.00,357.00 313.00,357.00\\n\" +\n" +
            "          \"             313.00,357.00 352.00,357.00 352.00,357.00\\n\" +\n" +
            "          \"             352.00,357.00 352.00,208.00 352.00,208.00\\n\" +\n" +
            "          \"             352.00,208.00 160.00,208.00 160.00,208.00 Z";



    public static ApkMsg builder() {
        if(instance == null)
            instance = new ApkMsg();

        return instance;
    }

    public ApkMsg() {
       File imgDir =  new File(App.getInstance().getExtPath() + pathVideoDir);
       if(!imgDir.exists())
           imgDir.mkdir();

    }


    public  Drawable getDrawable(String apkPath) {
        PackageInfo pi = App.getInstance().getPackageManager()
                .getPackageArchiveInfo( apkPath , 0);

        pi.applicationInfo.sourceDir       = apkPath;
        pi.applicationInfo.publicSourceDir = apkPath;

        return pi.applicationInfo.loadIcon(App.getInstance().getPackageManager());
    }


    private String getName(String apkPath) {
        PackageInfo pi = App.getInstance().getPackageManager()
                .getPackageArchiveInfo( apkPath , 0);

        pi.applicationInfo.sourceDir       = apkPath;
        pi.applicationInfo.publicSourceDir = apkPath;

        return (String) pi.applicationInfo.loadLabel(App.getInstance().getPackageManager());
    }

    private String getDirPath() {
        return App.getInstance().getExtPath() + pathVideoDir + "/" ;
    }

    public String pathGenerator() {
       return getDirPath() +  UUID.randomUUID().toString() + ".apk";
    }


    public FileModel generator(long fileLength , String apkName) {
       return new FileModel(pathGenerator() , apkName , fileLength , MsgType.APK ,0);
    }


    public FileModel generator(Uri apk) {
        String apkName = getName(apk.getPath());
        return new FileModel(apk.toString(), apkName , new File(apk.getPath()).length()
                ,MsgType.APK ,0);

    }


}
